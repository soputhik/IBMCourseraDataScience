SELECT CPSD.NAME_OF_SCHOOL, CPSD.COMMUNITY_AREA_NAME, CPSD.AVERAGE_STUDENT_ATTENDANCE
FROM CHICAGO_PUBLIC_SCHOOLS_DATA CPSD LEFT JOIN CENSUS_DATA CD ON CPSD.COMMUNITY_AREA_NUMBER = CD.COMMUNITY_AREA_NUMBER
WHERE CD.HARDSHIP_INDEX = 98;

SELECT CCD.CASE_NUMBER, CCD.PRIMARY_TYPE, CD.COMMUNITY_AREA_NAME
FROM CHICAGO_CRIME_DATA CCD LEFT JOIN CENSUS_DATA CD ON CCD.COMMUNITY_AREA_NUMBER = CD.COMMUNITY_AREA_NUMBER
WHERE CCD.LOCATION_DESCRIPTION LIKE '%SCHOOL%';

CREATE VIEW SCHOOLS_PROTECTED_RATINGS(School_Name, Safety_Rating, Family_Rating, Environment_Rating, Instruction_Rating, Leaders_Rating, Teacher_Rating)
AS SELECT NAME_OF_SCHOOL, SAFETY_ICON, FAMILY_INVOLVEMENT_ICON, ENVIRONMENT_ICON, INSTRUCTION_ICON, LEADERS_ICON, TEACHERS_ICON 
FROM CHICAGO_PUBLIC_SCHOOLS_DATA;

SELECT SCHOOL_NAME, LEADERS_RATING FROM SCHOOLS_PROTECTED_RATINGS;

--#SET TERMINATOR @ 
CREATE OR REPLACE PROCEDURE UPDATE_LEADERS_SCORE (IN IN_SCHOOL_ID INTEGER, IN IN_LEADER_SCORE INTEGER)

BEGIN 

	UPDATE CHICAGO_PUBLIC_SCHOOLS_DATA 
	SET LEADERS_SCORE = IN_LEADER_SCORE
	WHERE SCHOOL_ID = IN_SCHOOL_ID;
	
	IF (IN_LEADER_SCORE > 0 AND IN_LEADER_SCORE < 20) THEN
		UPDATE CHICAGO_PUBLIC_SCHOOLS_DATA 
		SET LEADERS_ICON = 'Very_Weak'
		WHERE SCHOOL_ID = IN_SCHOOL_ID;
	ELSEIF IN_LEADER_SCORE < 40 THEN
		UPDATE CHICAGO_PUBLIC_SCHOOLS_DATA 
		SET LEADERS_ICON = 'Weak'
		WHERE SCHOOL_ID = IN_SCHOOL_ID;
	ELSEIF IN_LEADER_SCORE < 60 THEN
		UPDATE CHICAGO_PUBLIC_SCHOOLS_DATA 
		SET LEADERS_ICON = 'Average'
		WHERE SCHOOL_ID = IN_SCHOOL_ID;
	ELSEIF IN_LEADER_SCORE < 80 THEN
		UPDATE CHICAGO_PUBLIC_SCHOOLS_DATA 
		SET LEADERS_ICON = 'Strong'
		WHERE SCHOOL_ID = IN_SCHOOL_ID;
	ELSEIF IN_LEADER_SCORE < 100 THEN
		UPDATE CHICAGO_PUBLIC_SCHOOLS_DATA 
		SET LEADERS_ICON = 'Very_Strong'
		WHERE SCHOOL_ID = IN_SCHOOL_ID;
	ELSE 
		ROLLBACK WORK;
	END IF;
	
	COMMIT WORK;

END
@